<!DOCTYPE html>
<html>
<head>
    <title>Terminal Test</title>
    <link rel="stylesheet" href="https://unpkg.com/@xterm/xterm/css/xterm.css" />
    <style>
        body { margin: 0; padding: 20px; background: #333; }
        #terminal { width: 100%; height: 400px; }
        .status { color: white; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="status" id="status">Initializing...</div>
    <div id="terminal"></div>
    
    <script type="module">
        import { Terminal } from 'https://unpkg.com/@xterm/xterm/lib/xterm.js';
        import { FitAddon } from 'https://unpkg.com/@xterm/addon-fit/lib/addon-fit.js';
        
        const statusEl = document.getElementById('status');
        const terminalEl = document.getElementById('terminal');
        
        statusEl.textContent = 'Creating terminal...';
        
        try {
            const terminal = new Terminal({
                cursorBlink: true,
                fontSize: 14,
                theme: {
                    background: '#1e1e1e',
                    foreground: '#d4d4d4',
                    cursor: '#d4d4d4',
                }
            });
            
            const fitAddon = new FitAddon();
            terminal.loadAddon(fitAddon);
            
            terminal.open(terminalEl);
            fitAddon.fit();
            
            statusEl.textContent = 'Connecting WebSocket...';
            
            const sessionId = Math.random().toString(36).substring(7);
            const ws = new WebSocket(`ws://localhost:3701?sessionId=${sessionId}`);
            
            ws.onopen = () => {
                statusEl.textContent = 'Connected!';
                terminal.write('Terminal ready! Type commands:\r\n');
            };
            
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'data') {
                    terminal.write(message.data);
                }
            };
            
            ws.onerror = (error) => {
                statusEl.textContent = 'WebSocket error: ' + error;
            };
            
            terminal.onData((data) => {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'input', data }));
                }
            });
            
        } catch (error) {
            statusEl.textContent = 'Error: ' + error.message;
            console.error(error);
        }
    </script>
</body>
</html>